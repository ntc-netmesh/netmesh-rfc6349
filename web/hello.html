<!DOCTYPE html>
<html>
  <head>
    <title>RFC-6349</title>

    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel = "stylesheet" href="css/main.css">
    <style>
      .nav-item .active {
        background-color: #6c757d!important;
      }
    </style>

    <!--Include eel.js - note this file doesn't exist in the 'web' directory -->
    <script type="text/javascript" src="/eel.js"></script>

    <script src="js/utilities/jquery-3.4.1.slim.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="js/utilities/popper.min.js"></script>
    <script src="js/utilities/bootstrap.js"></script>
    <script src="https://kit.fontawesome.com/dabe6c4264.js" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script src="js/utilities/pdfmake.min.js" crossorigin="anonymous"></script>
    <script src="js/utilities/vfs_fonts.js"></script>

    <script src="js/utilities/moment-with-locales.min.js" crossorigin="anonymous"></script>
    <script src="js/utilities/numeral.js" crossorigin="anonymous"></script>

    <script type="text/javascript" src="js/global.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/pdf-export.js"></script>

    <script>
      $(function () {
        $('#progress-status-info').hide();
        $('#progress-finished-title').hide();

        $('#btnGetGps .spinner-grow').hide();
        
        $('#results-info').hide();
      });

      // document.getElementById('login').style.display='block';
      (function() {
        'use strict';
        window.addEventListener('load', function() {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName('needs-validation');
          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add('was-validated');
            }, false);
          });
        }, false);
      })();
    </script>
  </head>

  <body onload="eel.retrieve_servers()">
    <nav class="navbar sticky-top navbar-expand navbar-light bg-light shadow">
      <a class="navbar-brand" href="#">
        <img src="/images/user_login.png" title="RFC-6349 Appllication" alt="Avatar" style="width: 48px;" >
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="#">Link</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Dropdown
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
          </li> -->
        </ul>
      </div>
      <div>
        <span class="text-muted">username</span>
        <!-- <button type="button" class="btn btn-link" onclick="logout()">Log out</button> -->
      </div>
    </nav>

    <main class="container">
      <!-- <h1>RFC-6349 Application</h1> -->
      <div class="py-md-4">
        
        <form id="mainForm" class="main-form needs-validation" onsubmit="return false" novalidate>
          <div class="card shadow mb-4">
            <div class="card-body">
              <div class="row">
                <div class="form-group col">
                  <label for="cir"><b>Internet Subscription Rate</b></label>
                  <input type="text" id="cir" class="form-control email" placeholder="Enter Mbps" required>
                  <div class="invalid-feedback">
                    Please provide the internet subscription rate of the customer
                  </div>
                </div>
                
                <div class="form-group col">
                  <label for="net_type"><b>Network Connection Type</b></label>
                  <select class="form-control" id="net_type">
                    <option value="" selected="selected" hidden="hidden">Select network type</option>
                    <option value="Dial-ip">Dial-up</option>
                    <option value="DSL">DSL</option>
                    <option value="Fiber-optic">Fiber-optic</option>
                    <option value="Cable Internet">Cable Internet</option>
                    <option value="Fixed Wireless">Fixed Wireless</option>
                    <option value="Broadband">Broadband</option>
                  </select>
                </div>
              </div>
      
              <div class="row">
                <div class="form-group col">
                  <label for="server"><b>Test Server</b></label>
                  <select class="form-control" id="server">
                  </select>
                </div>
              </div>
      
              <div class="row">
                <div class="form-group col">
                  <label for="lat"><b>GPS Latitude</b></label>
                  <input type="text" id="lat" class="form-control" placeholder="Latitude" required>
                  <div class="invalid-feedback">
                    Please provide the latitude coordinate of your current location
                  </div>
                </div>
                <div class="form-group col">
                  <label for="lon"><b>GPS Longitude</b></label>
                  <input type="text" id="lon" class="form-control" placeholder="Longitude" required>
                  <div class="invalid-feedback">
                    Please provide the longitude coordinate of your current location
                  </div>
                </div>
                <div class="form-group col-auto">
                  <label>&nbsp;</label>
                  <div id="btn-group-gps" class="input-group">
                    <button id="btnGetGps" type="button" class="btn btn-outline-primary" style="width: 160px;" onclick="get_gps_from_android()">
                      <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                      Get coordinates
                    </button>
                    <!-- <button type="button" class="btn btn-link"><i class="fa fa-question-circle"></i></button> -->
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <div class="float-right">
                <button id="btnUploadMode" class="btn btn-primary" role="button" type="submit" onclick="check_queue('normal')">
                  <i class="fa fa-long-arrow-alt-up"></i>
                  Upload Mode
                </button>
                <button id="btnDownloadMode" class="btn btn-primary" role="button" type="submit" onclick="check_queue('reverse')">
                  <i class="fa fa-long-arrow-alt-down"></i>
                  Download Mode
                </button>
                <!-- <button id="btnSimultaneousMode" class="btn btn-primary" role="button" type="submit" onclick="simultaneous()">
                  <i class="fa fa-arrows-alt-v"></i>
                  Simultaneous Mode
                </button>
                <button id="btnBidirectionalMode" class="btn btn-primary" role="button" type="submit" onclick="bidirectional()">
                  <span style="margin-left: 4px;">
                    <i class="fa fa-long-arrow-alt-up" style="margin-left: -4px;"></i>
                    <i class="fa fa-long-arrow-alt-down" style="margin-left: -4px;"></i>
                  </span>
                  Auto Mode
                </button> -->
              </div>
            </div>
          </div>
        </form>

        <div id="progress-status-info" class="card shadow mb-5">
          <div class="card-header">
            <span id="progress-status-title" class="h4"><b>Measuring <span id="mode"></span>...</b></span>
            <span id="progress-finished-title" class="h4"><b>Finished</b></span>
          </div>
          <div class="card-body">
            <div class="px-2">
              <span id="progress" class="text-primary">Initializing...</span>
              <span id="measurement-timer" class="text-secondary float-right">0:00</span>
              <!-- <ul class="list-unstyled">
                <li>
                  <div>
                    <span class="fa fa-check-circle text-success"></span>
                    <span>PLPMTUD Performed</span>
                  </div>
                </li>
              </ul> -->
            </div>
            <div id="process-progress-bar" class="progress prog_bar border border-secondary">
              <div id="dynamic" class="progress-bar bg-secondary progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="float-right">
              <button class="btn btn-outline-danger" role="button" id="cancel" onclick="cancel()" style="display:none;">Abort measuring</button>
            </div>
          </div>
        </div>

        <div class="mb-5" id="results-info">
          <div class="card shadow">
            <div class="card-header">
              <span class="h4"><b>Test results</b></span>
            </div>
            <div>
              <!-- <div class="card-group">
              </div> -->

              <div id="localResultCard" class="card rounded-0">
                <div class="card-body">
                  <p id="local_result" cols="50"></p>
                  <!-- <textarea id="remote_result" readonly="true" class="form-control" rows="7"></textarea> -->
                  <h5 class="card-title"><b>Local to Remote</b></h5>

                  <div class="row">
                    <div class="col-lg-5">
                      <table id="tblLocalResult" class="table table-sm table-bordered table-hover">
                        <tbody>
                          <tr>
                            <td>CIR</td>
                            <td>5</td>
                          </tr>
                          <tr>
                            <td>Path MTU</td>
                            <td>1500</td>
                          </tr>
                          <tr>
                            <td>Baseline RTT</td>
                            <td>9.534 ms</td>
                          </tr>
                          <tr>
                            <td>Bottleneck Bandwidth</td>
                            <td>94.5 Mbits/s</td>
                          </tr>
                          <tr>
                            <td>BDP</td>
                            <td>900963.0000000001 bits</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="col-lg-7">
                      <table id="local_wnd_stats" width="20" class="table table-hover" border=1></table>

                      <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
                        <li class="nav-item">
                          <a class="nav-link active" id="pills-tab0Content-tab" data-toggle="pill" href="#pills-tab0Content" role="tab" aria-controls="pills-tab0Content" aria-selected="true">Window Scan Test</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" id="pills-tab1Content-tab" data-toggle="pill" href="#pills-tab1Content" role="tab" aria-controls="pills-tab1Content" aria-selected="false">Throughput</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" id="pills-tab2Content-tab" data-toggle="pill" href="#pills-tab2Content" role="tab" aria-controls="pills-tab2Content" aria-selected="false">RTT</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" id="pills-tab3Content-tab" data-toggle="pill" href="#pills-tab3Content" role="tab" aria-controls="pills-tab3Content" aria-selected="false">Efficiency</a>
                        </li>
                      </ul>
                      <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="pills-tab0Content" role="tabpanel" aria-labelledby="pills-tab0Content-tab">1...</div>
                        <div class="tab-pane fade" id="pills-tab1Content" role="tabpanel" aria-labelledby="pills-tab1Content-tab">2...</div>
                        <div class="tab-pane fade" id="pills-tab2Content" role="tabpanel" aria-labelledby="pills-tab2Content-tab">3...</div>
                        <div class="tab-pane fade" id="pills-tab3Content" role="tabpanel" aria-labelledby="pills-tab3Content-tab">4...</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div id="remoteResultCard" class="card rounded-0">
                <div class="card-body">
                  <p id="remote_result" cols="50"></p>
                  <h5 class="card-title"><b>Remote to Local</b></h5>
                  <!-- <span class="text-danger h6">WARNING: This is NOT A REAL RESULT. This is for UI purposes only. (Remove this message when real test measurement were implemented)</span> -->

                  <div class="row">
                    <div class="col-lg-5">
                      <table id="tblRemoteResult" class="table table-sm table-bordered table-hover">
                        <!-- <thead style="margin: 0px;">
                          <tr>
                            <td style="width: 20%; min-width: 180px;"></td>
                            <td></td>
                          </tr>
                        </thead> -->
                        <tbody>
                          <tr>
                            <td>CIR</td>
                            <td>5</td>
                          </tr>
                          <tr>
                            <td>Path MTU</td>
                            <td>1500</td>
                          </tr>
                          <tr>
                            <td>Baseline RTT</td>
                            <td>9.534 ms</td>
                          </tr>
                          <tr>
                            <td>Bottleneck Bandwidth</td>
                            <td>94.5 Mbits/s</td>
                          </tr>
                          <tr>
                            <td>BDP</td>
                            <td>900963.0000000001 bits</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="col-lg-7">
                      <!-- <h5>Window Scan Test Results</h5> -->
                      <table id="remote_wnd_stats" width="20" class="table table-hover" border=1> </table>

                      <ul class="nav nav-pills mb-4" id="pills-rtab" role="tablist">
                        <li class="nav-item">
                          <a class="nav-link active" id="pills-rtab0Content-tab" data-toggle="pill" href="#pills-rtab0Content" role="tab" aria-controls="pills-rtab0Content" aria-selected="true">Window Scan Test</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" id="pills-rtab1Content-tab" data-toggle="pill" href="#pills-rtab1Content" role="tab" aria-controls="pills-rtab1Content" aria-selected="false">Throughput</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" id="pills-rtab2Content-tab" data-toggle="pill" href="#pills-rtab2Content" role="tab" aria-controls="pills-rtab2Content" aria-selected="false">RTT</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" id="pills-rtab3Content-tab" data-toggle="pill" href="#pills-rtab3Content" role="tab" aria-controls="pills-rtab3Content" aria-selected="false">Efficiency</a>
                        </li>
                      </ul>
                      <div class="tab-content" id="pills-rtabContent">
                        <div class="tab-pane fade show active" id="pills-rtab0Content" role="tabpanel" aria-labelledby="pills-rtab0Content-tab">1...</div>
                        <div class="tab-pane fade" id="pills-rtab1Content" role="tabpanel" aria-labelledby="pills-rtab1Content-tab">2...</div>
                        <div class="tab-pane fade" id="pills-rtab2Content" role="tabpanel" aria-labelledby="pills-rtab2Content-tab">3...</div>
                        <div class="tab-pane fade" id="pills-rtab3Content" role="tabpanel" aria-labelledby="pills-rtab3Content-tab">4...</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <div class="float-right">
                <button id="btnSaveAsPdf" class="btn btn-primary" role ="button" data-test-mode="" onclick="generateTestResultsPdfReport()">
                  <i class="fa fa-file-pdf"></i>
                  <span>Save as PDF</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="pdfViewer" class="mb-1">
        </div>
      </div>
      <!-- Modal -->
      <div class="modal fade" id="modalQueue" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="modalQueueLabel" aria-hidden="true" style="z-index: 1050;">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="modalQueueLabel">You're in queue</h4>
            </div>
            <div class="modal-body">
              <div>
                <div class="row justify-content-center">
                  <label id="queue-label-many" class="h5 text-dark">
                    <span><strong id="queue_remaining">5</strong></span>
                    <span>tests still being performed somewhere...</span>
                  </label>
                  <label id="queue-label-one" class="h5 text-dark">
                    <span><strong>You're next.</strong></span>
                    <span>Please wait...</span>
                  </label>
                </div>
                <!-- <div class="spinner-grow spinner-grow-sm text-info float-right" role="status">
                  <span class="sr-only">Loading...</span>
                </div> -->
              </div>
              <div class="progress border border-dark" style="height: 10px;">
                <div id="queue-progress" class="progress-bar bg-dark progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
                <!-- <div class="progress-bar bg-light progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;"></div> -->
              </div>
            </div>
            <div class="modal-footer">
              <button id="btnLeaveQueue" class="btn btn-outline-danger" type="button" onclick="confirmLeaveQueue()">Leave queue</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="modalLeaveQueueConfirmation" tabindex="-1" role="dialog" aria-labelledby="modalLeaveQueueConfirmationLabel" aria-hidden="true" style="z-index: 1051;">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <!-- <div class="modal-header">
              <h4 class="modal-title" id="modalLeaveQueueConfirmationLabel">Are you sure?</h4>
            </div> -->
            <div class="modal-body">
              Are you sure you want to leave the queue?
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" role="button" data-dismiss="modal">Stay in queue</button>
              <button class="btn btn-outline-danger" role="button" data-dismiss="modal" onclick="leaveQueue()">Leave queue</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>